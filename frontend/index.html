<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>e-Rupee Plus</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
        button { padding: 10px 20px; margin: 5px; }
        input { padding: 5px; margin: 5px; }
    </style>
</head>
<body>
    <h1>e-Rupee Plus</h1>
    <button onclick="connectWallet()">Connect Wallet</button><br>
    <p id="account">Account: Not connected</p>
    <p id="balance">Balance: 0 eINR</p>
    <input id="recipient" placeholder="Recipient Address" size="40"><br>
    <input id="amount" placeholder="Amount (eINR)" type="number"><br>
    <button onclick="sendERupee()">Send e-Rupee</button>

    <script src="node_modules/web3/dist/web3.min.js"></script>
    <script>
        let web3, accounts, contract;
        const contractAddress = "YOUR_CONTRACT_ADDRESS_HERE"; // Replace with address from Step 2
        const contractABI = [
            // Paste ABI from truffle compile output or Remix
            {"inputs":[{"internalType":"uint256","name":"initialSupply","type":"uint256"}],"stateMutability":"nonpayable","type":"constructor"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Cashback","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},
            {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"getBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"mint","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"rbi","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"transactionCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
        ];

        async function connectWallet() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                contract = new web3.eth.Contract(contractABI, contractAddress);
                document.getElementById("account").innerText = `Account: ${accounts[0]}`;
                updateBalance();
            } else {
                alert("Please install MetaMask!");
            }
        }

        async function updateBalance() {
            const balance = await contract.methods.getBalance(accounts[0]).call();
            document.getElementById("balance").innerText = `Balance: ${balance / 100} eINR`; // Divide by 100 (2 decimals)
        }

        async function sendERupee() {
            const recipient = document.getElementById("recipient").value;
            const amount = document.getElementById("amount").value * 100; // Convert to smallest unit
            await contract.methods.transfer(recipient, amount).send({ from: accounts[0] })
                .on('receipt', function() {
                    alert("Transaction successful!");
                    updateBalance();
                })
                .on('error', function(error) {
                    alert("Transaction failed: " + error.message);
                });
        }
    </script>
</body>
</html>